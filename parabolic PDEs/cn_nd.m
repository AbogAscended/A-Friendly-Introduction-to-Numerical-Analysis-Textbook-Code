function [w, x] = cn_nd ( a,b, NX, t0, tf, NT, D, bc, f, source, decay )x = linspace ( a, b, NX+1 );% t = linspace ( t0, tf, NT+1 );dx = (b-a) / NX;dt = (tf-t0) / NT;lambda = D * dt / (2 * dx^2);wnew = zeros ( NX+1,1 );wold = zeros ( NX+1,1 );for i = 1 : NX+1    wold(i) = feval ( f, x(i) );end;for i= 1 : NX+1    sold(i) = feval ( source, x(i), t0 );	dold(i) = feval ( decay, x(i), t0 );end;sub   = -lambda * ones ( 1, NX );super = sub;sub(NX) = 2*sub(NX);super(1) = 2*super(1);[ alpha0 p0 q0 r0 ] = feval ( bc, t0 );for j = 2 : NT+1    [ alpha1 p1 q1 r1 ] = feval ( bc, t0 + (j-1)*dt );		diag  = ( 1 + 2 * lambda) * ones ( 1, NX+1 );	rhs(1) = ( 1 - 2 * lambda - (dt/2) * dold(1) ) * wold(1) + 2 * lambda * wold(2) + 2 * lambda * dx * ( alpha0 + alpha1 );	snew(1) = feval ( source, x(1), t0 + (j-1)*dt );	dold(1) = feval ( decay, x(1), t0 + (j-1)*dt );	diag(1) = diag(1) + (dt/2) * dold(1);		for i = 2 : NX	    rhs(i) = lambda * wold(i-1) + ( 1 - 2 * lambda - (dt/2) * dold(i) ) * wold(i) + lambda * wold(i+1);		snew(i) = feval ( source, x(i), t0 + (j-1)*dt );		dold(i) = feval ( decay, x(i), t0 + (j-1)*dt );		diag(i) = diag(i) + (dt/2) * dold(i);	end;		rhs(NX+1) = 2 * lambda * wold(NX) + ( 1 - 2 * lambda - 2 * lambda * dx * p0 / q0 - (dt/2) * dold(NX+1) ) * wold(NX+1) + 2 * lambda * dx * ( r0 / q0 + r1 / q1 );	snew(NX+1) = feval ( source, x(NX+1), t0 + (j-1)*dt );	dold(NX+1) = feval ( decay, x(NX+1), t0 + (j-1)*dt );	diag(NX+1) = diag(NX+1) + 2 * lambda * dx * p1 / q1 + (dt/2) * dold(NX+1);	rhs = rhs + (dt/2) * ( sold + snew );	    wnew = tridiagonal ( sub, diag, super, rhs );	wold = wnew;	sold = snew;	alpha0 = alpha1; p0 = p1; q0 = q1; r0 = r1;end;w = wnew;