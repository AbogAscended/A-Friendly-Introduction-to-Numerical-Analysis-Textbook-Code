function [w, x, t] = ftcs_nd ( a,b, NX, t0, tf, NT, D, bc, f, source, decay )x = linspace ( a, b, NX+1 );t = linspace ( t0, tf, NT+1 );dx = (b-a) / NX;dt = (tf-t0) / NT;lambda = D * dt / dx^2;diag = 1 - 2 * lambda;wnew = zeros ( NX+1,1 );wold = zeros ( NX+1,1 );for i = 1 : NX+1    wold(i) = feval ( f, x(i) );end;for j = 2 : NT+1    [alpha p q r] = feval ( bc, t(j-1) );    	wnew(1) = ( diag - dt * feval ( decay, x(1), t(j-1) ) ) * wold(1) + 2 * lambda * wold(2) + dt * feval ( source, x(1), t(j-1) ) + 2*lambda*dx*alpha;    for i = 2 : NX	    wnew(i) = lambda * wold(i-1) + ( diag - dt * feval ( decay, x(i), t(j-1) ) ) * wold(i) + lambda * wold(i+1) + dt * feval ( source, x(i), t(j-1) );	end;	wnew(NX+1) = ( diag - 2*lambda*dx*p/q - dt * feval ( decay, x(NX+1), t(j-1) ) ) * wold(NX+1) + 2 * lambda * wold(NX) + dt * feval ( source, x(NX+1), t(j-1) ) + 2*lambda*dx*r/q;		wold = wnew;end;w = wnew;