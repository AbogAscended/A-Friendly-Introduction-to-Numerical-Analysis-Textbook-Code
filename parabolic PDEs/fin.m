function [inner, middle, outer] = fin ( a,b, NX, t0, tf, NT, D, bc, f, source, decay )r = linspace ( a, b, NX+1 );dr = (b-a) / NX;dt = (tf-t0) / NT;lambda = D * dt / (2 * dr^2);mu = D * dt / ( 2 * dr );wnew = zeros ( NX+1,1 );wold = zeros ( NX+1,1 );for i = 2 : NX+1    wold(i) = feval ( f, r(i) );end;inner = zeros( NT+1, 1 );middle = inner;outer = inner;for i= 2 : NX+1    sold(i) = feval ( source, r(i), t0 );	dold(i) = feval ( decay, r(i), t0 );end;sub   = [ -( lambda - 0.5 * mu ./ r(3:NX) ), -2*lambda ];super = -( lambda + 0.5 * mu ./ r(2:NX) );[ alpha0 p0 q0 r0 ] = feval ( bc, t0 );wold(1) = alpha0;inner(1) = wold(1);middle(1) = wold(NX/2+1);outer(1) = wold(NX+1);for j = 2 : NT+1    [ alpha1 p1 q1 r1 ] = feval ( bc, t0 + (j-1)*dt );	wnew(1) = alpha1;		diag  = ( 1 + 2 * lambda) * ones ( 1, NX ); 		for i = 2 : NX	    rhs(i-1) = ( lambda - 0.5 * mu / r(i) ) * wold(i-1) + ( 1 - 2 * lambda - (dt/2) * dold(i) ) * wold(i) + ( lambda + 0.5 * mu / r(i) ) * wold(i+1);		snew(i) = feval ( source, r(i), t0 + (j-1)*dt );		dold(i) = feval ( decay, r(i), t0 + (j-1)*dt );		diag(i-1) = diag(i-1) + (dt/2) * dold(i);	end;    rhs(NX) = 2*lambda*wold(NX) + ( 1-2*lambda-2*dr*p0/q0*(lambda+0.5*mu/r(NX+1))-(dt/2)*dold(NX+1) ) * wold(NX+1) + 2*dr*(lambda+0.5*mu/r(NX+1))*(r0/q0 + r1/q1);	snew(NX+1) = feval ( source, r(NX+1), t0 + (j-1)*dt );	dold(NX+1) = feval ( decay, r(NX+1), t0 + (j-1)*dt );	diag(NX) = diag(NX) + (dt/2) * dold(NX+1) + 2*dr*p1/q1*(lambda+0.5*mu/r(NX+1));	rhs(1) = rhs(1) + (lambda-0.5*mu/r(1))*wnew(1);	rhs = rhs + (dt/2) * ( sold(2:NX+1) + snew(2:NX+1) );	    wnew(2:NX+1) = tridiagonal ( sub, diag, super, rhs );	wold = wnew;	sold = snew;	alpha0 = alpha1; p0 = p1; q0 = q1; r0 = r1;		inner(j) = wold(1);    middle(j) = wold(NX/2+1);    outer(j) = wold(NX+1);end;